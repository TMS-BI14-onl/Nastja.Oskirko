--ПР 3

/*
Кинопрокат
1. Фильм (id_фильма, название, год выпуска, id_киностудии, id_режиссера, id_актера)
2. Киностудия (id_киностудии, название, год основания)
3. Режиссер (id_режиссера, ФИО, номер паспорта, год рождения, пол)
4. Актеры (id_актера, ФИО, номер паспорта, год рождения, пол)
5. Билеты(id_билета, id_фильма, id_кинотеатра, дата показа, дата продажи, цена)
6. Кинотеатр (id_кинотеатра, название, адрес, телефон)


1)Вывести данные о фильмах и кол-ве проданных билетов в зависимости от того, как рано их покупают (за 1,2, ... дней до показа). Результаты вывести в виде транспорнированной таблицы (оси - название фильма, кол-во дней от продажи до показа)
2)Вывести сведения о фильме с самым большим кассовым сбором за все время. 

1)
SELECT ф.название, [0], [1], [2], [3],...
FROM
(
SELECT ф.название, DATEDIFF(DAY,дата продажи, дата показа) AS дней до показа
FROM Фильм ф LEFT JOIN Билеты б ON ф.id_фильма=б.id_фильма
) AS SourceTable
PIVOT
(
COUNT(дней до показа)
FOR дней до показа IN ([0], [1], [2], [3],...)
) AS PivotTable



2)

SELECT TOP 1 WITH TIES 1 ф.название, год выпуска, к.название, р.ФИО, SUM(цена) AS сборы
FROM
(
SELECT ф.название, год выпуска, к.название, р.ФИО, цена
FROM Фильм  ф LEFT JOIN Билеты б ON ф.id_фильма=б.id_фильма
	LEFT JOIN Киностудия к ON ф.id_киностудии=к.id_киностудии
	LEFT JOIN Режиссер р ON ф.id_режиссера=р.id_режиссера
)
GROUP BY 	ф.название, год выпуска, к.название, р.ФИО
ORDER BY сборы DESC
*/